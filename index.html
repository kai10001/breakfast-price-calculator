<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#FF6B35">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ÁæéËÄåÁæéË®àÁÆóÊ©ü">
<link rel="manifest" href="manifest.json">
<title>ÁæéËÄåÁæéÊó©È§ê Ë®àÁÆóÊ©ü</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=DM+Mono:wght@400;500&display=swap');

  :root {
    --bg: #1A1209;
    --surface: #261A0A;
    --surface2: #321F0C;
    --accent: #FF6B35;
    --accent2: #FFB347;
    --text: #FFF3E0;
    --text2: #C4956A;
    --text3: #7A5C3A;
    --border: #3D2810;
    --green: #4CAF7D;
    --red: #E05252;
    --shadow: 0 4px 24px rgba(0,0,0,0.5);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Noto Sans TC', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Header */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    padding: 12px 16px;
  }

  .header-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .store-name {
    font-size: 18px;
    font-weight: 900;
    color: var(--accent);
    letter-spacing: 0.05em;
  }

  .total-bar {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .total-label {
    font-size: 13px;
    color: var(--text2);
    font-weight: 500;
  }

  .total-amount {
    font-family: 'DM Mono', monospace;
    font-size: 26px;
    font-weight: 500;
    color: var(--accent2);
  }

  .total-amount span {
    font-size: 14px;
    color: var(--text2);
  }

  .btn-clear {
    background: transparent;
    border: 1px solid var(--red);
    color: var(--red);
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 12px;
    font-family: 'Noto Sans TC', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-clear:active { background: var(--red); color: white; transform: scale(0.95); }

  /* Category tabs */
  .tabs-wrapper {
    overflow-x: auto;
    scrollbar-width: none;
    padding: 10px 16px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    -ms-overflow-style: none;
  }
  .tabs-wrapper::-webkit-scrollbar { display: none; }

  .tabs {
    display: flex;
    gap: 8px;
    width: max-content;
  }

  .tab {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text2);
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 12px;
    font-family: 'Noto Sans TC', sans-serif;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s;
    font-weight: 500;
  }

  .tab.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .tab:active { transform: scale(0.95); }

  /* Menu items */
  .menu-section {
    padding: 12px 16px;
    display: none;
  }
  .menu-section.active { display: block; }

  .section-note {
    font-size: 11px;
    color: var(--text3);
    margin-bottom: 10px;
    padding: 6px 10px;
    background: var(--surface);
    border-radius: 8px;
    border-left: 3px solid var(--accent2);
  }

  .item-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .item-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    transition: border-color 0.15s;
  }

  .item-card.has-qty {
    border-color: var(--accent);
    background: var(--surface2);
  }

  .item-name {
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.3;
  }

  .item-price {
    font-family: 'DM Mono', monospace;
    font-size: 15px;
    color: var(--accent2);
    font-weight: 500;
  }

  .item-price::before { content: '$'; font-size: 11px; }

  .qty-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 2px;
  }

  .qty-btn {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    border: none;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.1s;
    line-height: 1;
  }

  .qty-btn.minus {
    background: var(--border);
    color: var(--text2);
  }

  .qty-btn.plus {
    background: var(--accent);
    color: white;
  }

  .qty-btn:active { transform: scale(0.88); }

  .qty-display {
    font-family: 'DM Mono', monospace;
    font-size: 17px;
    font-weight: 500;
    color: var(--text);
    min-width: 24px;
    text-align: center;
  }

  /* Cart summary */
  .cart-section {
    display: none;
    padding: 16px;
  }
  .cart-section.active { display: block; }

  .cart-empty {
    text-align: center;
    color: var(--text3);
    padding: 60px 20px;
    font-size: 14px;
  }
  .cart-empty-icon { font-size: 48px; margin-bottom: 12px; }

  .cart-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 14px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .cart-item-info { flex: 1; }
  .cart-item-name { font-size: 14px; font-weight: 700; margin-bottom: 3px; }
  .cart-item-detail { font-size: 12px; color: var(--text2); font-family: 'DM Mono', monospace; }

  .cart-item-subtotal {
    font-family: 'DM Mono', monospace;
    font-size: 16px;
    color: var(--accent2);
    font-weight: 500;
  }

  .cart-total-row {
    border-top: 1px solid var(--border);
    padding-top: 14px;
    margin-top: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .cart-total-label { font-size: 15px; font-weight: 700; color: var(--text2); }
  .cart-total-amount {
    font-family: 'DM Mono', monospace;
    font-size: 32px;
    color: var(--accent);
    font-weight: 500;
  }

  /* Bottom nav */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
    display: flex;
    padding: 8px 0 env(safe-area-inset-bottom, 8px);
    z-index: 100;
  }

  .nav-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    padding: 6px;
    cursor: pointer;
    border: none;
    background: transparent;
    color: var(--text3);
    font-family: 'Noto Sans TC', sans-serif;
    font-size: 10px;
    transition: color 0.15s;
    position: relative;
  }

  .nav-btn.active { color: var(--accent); }
  .nav-btn .icon { font-size: 22px; line-height: 1; }

  .cart-badge {
    position: absolute;
    top: 4px;
    right: calc(50% - 18px);
    background: var(--red);
    color: white;
    border-radius: 10px;
    font-size: 10px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    display: none;
  }

  .cart-badge.show { display: flex; }

  /* Main content padding for bottom nav */
  .main-content { padding-bottom: 80px; }

  /* Quick add animation */
  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }

  .pop { animation: pop 0.2s ease; }

  /* Offline indicator */
  .offline-bar {
    background: var(--red);
    color: white;
    text-align: center;
    font-size: 11px;
    padding: 4px;
    display: none;
  }
  .offline-bar.show { display: block; }
</style>
</head>
<body>

<div class="offline-bar" id="offlineBar">‚ö° Èõ¢Á∑öÊ®°Âºè</div>

<div class="header">
  <div class="header-top">
    <div class="store-name">üç≥ ÁæéËÄåÁæé ÂçóËààÂ∫ó</div>
    <button class="btn-clear" onclick="clearAll()">Ê∏ÖÁ©∫</button>
  </div>
  <div class="total-bar">
    <div>
      <div class="total-label">ÁõÆÂâçÁ∏ΩÈáëÈ°ç</div>
    </div>
    <div class="total-amount"><span>$</span><span id="totalAmount">0</span></div>
  </div>
</div>

<div class="tabs-wrapper" id="tabsWrapper">
  <div class="tabs" id="tabsContainer"></div>
</div>

<div class="main-content" id="mainContent"></div>

<nav class="bottom-nav">
  <button class="nav-btn active" id="navMenu" onclick="switchView('menu')">
    <span class="icon">üçΩÔ∏è</span>
    ÈªûÈ§ê
  </button>
  <button class="nav-btn" id="navCart" onclick="switchView('cart')">
    <span class="icon">üßæ</span>
    <span class="cart-badge" id="cartBadge">0</span>
    ÊòéÁ¥∞
  </button>
</nav>

<script>
// ===== ËèúÂñÆË≥áÊñô =====
const MENU = [
  {
    id: 'burger', label: 'ü•™ Êº¢Â†°', note: 'Âä†Ëõã +$15ÔΩúÂä†Ëµ∑Âè∏ +$10',
    items: [
      { name: 'Êº¢Â†°', price: 25 }, { name: 'ËõãÂ†°', price: 30 }, { name: 'ÈÆ™È≠öÂ†°', price: 25 },
      { name: 'ÈõûËÇâÂ†°', price: 30 }, { name: 'ÁáªÈõûÂ†°', price: 30 }, { name: 'Ëä±ÊûùÂ†°', price: 35 },
      { name: 'È±àÈ≠öÂ†°', price: 35 }, { name: 'Ëù¶ËÇâÂ†°', price: 35 }, { name: 'Ë±¨ÊéíÂ†°', price: 35 },
      { name: 'È¶ôÁÉ§ÈõûËÖøÂ†°', price: 35 }, { name: 'Ëè≤ÂäõÈõûËÖøÂ†°', price: 35 },
      { name: 'ÂíîÂï¶ÈõûËÖøÂ†°ÔºàÂéüÂë≥Ôºâ', price: 45 }, { name: 'ÂíîÂï¶ÈõûËÖøÂ†°ÔºàËæ£Âë≥Ôºâ', price: 45 },
      { name: 'Âä†Ëõã', price: 15 }, { name: 'Âä†Ëµ∑Âè∏', price: 10 },
    ]
  },
  {
    id: 'toast', label: 'üçû ÁÉ§ÂêêÂè∏', note: 'ÂçáÁ¥ö‰∏πÈ∫•ÂêêÂè∏ +$20',
    items: [
      { name: 'Â∑ßÂÖãÂäõÂêêÂè∏', price: 10 }, { name: 'ËçâËéìÂêêÂè∏', price: 10 }, { name: 'Ëä±ÁîüÂêêÂè∏', price: 10 },
      { name: 'Â•∂Ê≤πÂêêÂè∏', price: 10 }, { name: 'ÁÖâ‰π≥ÂêêÂè∏', price: 10 }, { name: 'Â•∂ÈÖ•ÂêêÂè∏', price: 15 },
      { name: 'ËÇâÈ¨ÜÂêêÂè∏', price: 15 }, { name: 'ÁéâÁ±≥ÂêêÂè∏', price: 15 }, { name: 'ÁÅ´ËÖøÂêêÂè∏', price: 15 },
      { name: 'ÁáªÈõûÂêêÂè∏', price: 20 }, { name: 'ÂüπÊ†πÂêêÂè∏', price: 20 }, { name: 'ÈÆ™È≠öÂêêÂè∏', price: 20 },
      { name: 'ÁÖéËõãÂêêÂè∏', price: 25 }, { name: 'Ê≥ïÂúãÂêêÂè∏', price: 30 }, { name: 'Ë±¨ÊéíÂêêÂè∏', price: 30 },
      { name: 'È±àÈ≠öÂêêÂè∏', price: 35 }, { name: 'Ëä±ÊûùÂêêÂè∏', price: 35 },
      { name: 'ÂíîÂï¶ÈõûËÖøÂêêÂè∏ÔºàÂéüÂë≥Ôºâ', price: 45 }, { name: 'ÂíîÂï¶ÈõûËÖøÂêêÂè∏ÔºàËæ£Âë≥Ôºâ', price: 45 },
      { name: 'ÂçáÁ¥ö‰∏πÈ∫•', price: 20 },
    ]
  },
  {
    id: 'egg', label: 'ü•û ËõãÈ§Ö',
    items: [
      { name: 'ÂéüÂë≥ËõãÈ§Ö', price: 25 }, { name: 'ËÇâÈ¨ÜËõãÈ§Ö', price: 30 }, { name: 'ÁÅ´ËÖøËõãÈ§Ö', price: 30 },
      { name: 'ÁéâÁ±≥ËõãÈ§Ö', price: 30 }, { name: 'Ëî¨ËèúËõãÈ§Ö', price: 30 }, { name: 'Ëµ∑Âè∏ËõãÈ§Ö', price: 35 },
      { name: 'ÁÜ±ÁãóËõãÈ§Ö', price: 35 }, { name: 'ÂüπÊ†πËõãÈ§Ö', price: 35 }, { name: 'ÈÆ™È≠öËõãÈ§Ö', price: 35 },
      { name: 'ÁáªÈõûËõãÈ§Ö', price: 40 }, { name: 'Ê≥°ËèúËõãÈ§Ö', price: 40 }, { name: 'ËòøËîîÁ≥ïËõãÈ§Ö', price: 40 },
      { name: 'Ë±¨ÊéíËõãÈ§Ö', price: 45 }, { name: 'Ëè≤ÂäõÈõûËÖøËõãÈ§Ö', price: 50 }, { name: 'ÂíîÂï¶ÈõûËÖøËõãÈ§Ö', price: 60 },
    ]
  },
  {
    id: 'thick', label: 'üçû ÂéöÁâá',
    items: [
      { name: 'Â∑ßÂÖãÂäõÂéöÁâá', price: 20 }, { name: 'Ëä±ÁîüÂéöÁâá', price: 20 }, { name: 'ËçâËéìÂéöÁâá', price: 20 },
      { name: 'Â•∂ÈÖ•ÂéöÁâá', price: 20 }, { name: 'Â•∂Ê≤πÂéöÁâá', price: 20 }, { name: 'ÁÖâ‰π≥ÂéöÁâá', price: 20 },
      { name: 'ÁÅ´ËÖøÁéâÁ±≥ÂéöÁâá', price: 30 }, { name: 'ÁéâÁ±≥Ëµ∑Âè∏ÂéöÁâá', price: 35 },
      { name: 'ÈÆ™È≠öÁéâÁ±≥ÂéöÁâá', price: 35 }, { name: 'ÈÆ™È≠öËµ∑Âè∏ÂéöÁâá', price: 40 },
    ]
  },
  {
    id: 'box', label: 'üßá ÁõíÈÖ•',
    items: [
      { name: 'Â∑ßÂÖãÂäõÁõíÈÖ•', price: 20 }, { name: 'ËçâËéìÁõíÈÖ•', price: 20 }, { name: 'Ëä±ÁîüÁõíÈÖ•', price: 20 },
      { name: 'Â•∂Ê≤πÁõíÈÖ•', price: 20 }, { name: 'ÁÖâ‰π≥ÁõíÈÖ•', price: 20 }, { name: 'Â•∂ÈÖ•ÁõíÈÖ•', price: 20 },
      { name: 'ÁÅ´ËÖøÁõíÈÖ•', price: 20 }, { name: 'ÁéâÁ±≥ÁõíÈÖ•', price: 25 }, { name: 'Ëµ∑Âè∏ÁõíÈÖ•', price: 25 },
      { name: 'ÈÆ™È≠öÁõíÈÖ•', price: 25 }, { name: 'ÁéâÁ±≥ÈÆ™È≠öÁõíÈÖ•', price: 30 }, { name: 'ÁéâÁ±≥Ëµ∑Âè∏ÁõíÈÖ•', price: 30 },
      { name: 'ÈÆ™È≠öËµ∑Âè∏ÁõíÈÖ•', price: 35 }, { name: 'ÁáªÈõûÁõíÈÖ•', price: 30 }, { name: 'ËñØÁöÆÁõíÈÖ•', price: 45 },
    ]
  },
  {
    id: 'club', label: 'üåØ Á∏ΩÂåØ',
    items: [
      { name: 'Ë±¨ÊéíÁ∏ΩÂåØ', price: 60 }, { name: 'Á∏ΩÂåØÂêêÂè∏', price: 55 },
      { name: 'ÂíîÂï¶ÈõûËÖøÁ∏ΩÂåØ', price: 65 }, { name: 'Ëè≤ÂäõÈõûËÖøÁ∏ΩÂåØ', price: 65 },
    ]
  },
  {
    id: 'fried', label: 'üçü ÁèæÁÇ∏',
    items: [
      { name: 'È¶ôÈÖ•ÈõûÊü≥Ê¢ù', price: 10 }, { name: 'ËñØÈ§Ö', price: 15 }, { name: 'ËñØÊ¢ù', price: 20 },
      { name: 'È∫•ÂÖãÈõûÂ°ä', price: 25 }, { name: 'Â∞èÈõûÁêÉ', price: 25 },
    ]
  },
  {
    id: 'light', label: 'üåÆ ËºïÈ£ü',
    items: [
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÂ∑ßÂÖãÂäõÔºâ', price: 25 }, { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàËçâËéìÔºâ', price: 25 },
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàËä±ÁîüÔºâ', price: 25 }, { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÂ•∂ÈÖ•Ôºâ', price: 25 },
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÁÖâ‰π≥Ôºâ', price: 25 }, { name: 'Ëî¨Ëèú‰π≥ÈÖ™È§Ö', price: 30 },
      { name: 'ËõãËÇâÈ¨Ü‰π≥ÈÖ™È§Ö', price: 45 }, { name: 'ÈÆ™È≠öÁéâÁ±≥‰π≥ÈÖ™È§Ö', price: 40 },
    ]
  },
  {
    id: 'hot', label: 'üå≠ ÁÜ±È£ü',
    items: [
      { name: 'ÁÜ±ÁãóÔºà3Ê¢ùÔºâ', price: 15 }, { name: 'ÁÜ±ÁãóÂêêÂè∏ËõãÊç≤', price: 25 }, { name: 'ÁÜ±ÁãóÊç≤ËõãÔºà3Ê¢ùÔºâ', price: 30 },
      { name: 'Ëî•Ëõã', price: 15 }, { name: 'ÁéâÁ±≥Ëõã', price: 25 }, { name: 'Â∞èËÇâË±Ü', price: 20 },
      { name: 'ËòøËîîÁ≥ïÔºà2Â°äÔºâ', price: 25 }, { name: 'ËòøËîîÁ≥ïÔºà1Â°äÔºâ', price: 15 },
      { name: 'ÁîüÁÖéÂåÖ', price: 25 }, { name: '‰∏ÄÂè£ÁÖéÈ§É', price: 20 }, { name: 'ÈçãË≤º', price: 25 },
      { name: 'È¶ôÈÖ•ÁÖéÈ§É', price: 30 },
    ]
  },
  {
    id: 'noodle', label: 'üçú ÈçãÁáíÈ∫µ',
    items: [
      { name: 'ÊÑèÈ∫µ', price: 55 }, { name: 'ÂÜ¨Á≤â', price: 55 }, { name: 'ÈõûÁµ≤È∫µ', price: 55 }, { name: 'ÁÉèÈæçÈ∫µ', price: 55 },
      { name: 'Ê≥°ËèúÊÑèÈ∫µ', price: 70 }, { name: 'Ê≥°ËèúÂÜ¨Á≤â', price: 70 }, { name: 'Ê≥°ËèúÈõûÁµ≤È∫µ', price: 70 }, { name: 'Ê≥°ËèúÁÉèÈæçÈ∫µ', price: 70 },
    ]
  },
  {
    id: 'instant', label: 'üçú Ê≥°È∫µ',
    items: [
      { name: 'Ê≥°ËèúÊ≥°È∫µ', price: 70 }, { name: 'ËÇâÁá•Ê≥°È∫µ', price: 55 }, { name: 'ÁâõËÇâÊπØÊ≥°È∫µ', price: 55 },
    ]
  },
  {
    id: 'pasta', label: 'üçù Áæ©Â§ßÂà©È∫µ',
    items: [
      { name: 'ËåÑÊ±ÅÁæ©Â§ßÂà©È∫µ', price: 40 }, { name: 'ÈªëËÉ°Ê§íÁæ©Â§ßÂà©È∫µ', price: 40 },
    ]
  },
  {
    id: 'porridge', label: 'üç≤ Á≤•ÂìÅ',
    items: [
      { name: 'Âè∞ÂºèÈππÁ≤•', price: 50 }, { name: 'ÁöÆËõãÁò¶ËÇâÁ≤•', price: 60 },
    ]
  },
  {
    id: 'meat', label: 'ü•© ËÇâÊéíÂñÆÈªû',
    items: [
      { name: 'Êº¢Â†°ËÇâ', price: 10 }, { name: 'ÁáªÈõûËÇâ', price: 15 }, { name: 'Ë±¨Êéí', price: 20 },
      { name: 'È¶ôÁÉ§ÈõûËÖø', price: 25 }, { name: 'Ëè≤ÂäõÈõûÊéí', price: 25 }, { name: 'È±àÈ≠ö', price: 25 },
      { name: 'Ëù¶ËÇâ', price: 25 }, { name: 'Ëä±Êûù', price: 25 }, { name: 'ÂíîÂï¶ÈõûËÖøËÇâ', price: 35 },
    ]
  },
  {
    id: 'drink', label: 'ü•§ È£≤Êñô', note: 'ÂçáÁ¥öÂ§ßÊùØ +$5',
    items: [
      { name: 'Á¥ÖËå∂', price: 10 }, { name: 'Ë±ÜÊºø', price: 10 }, { name: 'Â•∂Ëå∂', price: 15 },
      { name: 'ÂíñÂï°ÁâõÂ•∂', price: 15 }, { name: 'ÂèØÂèØ', price: 15 }, { name: 'ÂÜ∞ÂèØÊ®Ç', price: 15 },
      { name: 'Êü≥Ê©ôÊ±Å', price: 15 }, { name: 'Ê™∏Ê™¨Á¥ÖËå∂', price: 15 }, { name: 'Ê∞¥ËúúÊ°ÉÊ±Å', price: 15 },
      { name: 'ÁôæÈ¶ôÊûúÊ±Å', price: 15 }, { name: 'ÈÆÆÂ•∂Ëå∂', price: 20 }, { name: 'ÈÆÆÂ•∂ÂíñÂï°ÔºàÂ§ßÊùØÔºâ', price: 30 },
      { name: 'ÂçáÁ¥öÂ§ßÊùØ', price: 5 },
    ]
  },
  {
    id: 'winter', label: '‚ùÑÔ∏è ÂÜ¨Â≠£ÈôêÂÆö',
    items: [
      { name: 'ÁéâÁ±≥ÊøÉÊπØÔºàÂ∞èÊùØÔºâ', price: 15 }, { name: 'ÁéâÁ±≥ÊøÉÊπØÔºàÂ§ßÊùØÔºâ', price: 25 },
    ]
  },
];

// ===== ÁãÄÊÖã =====
const qty = {}; // itemKey -> quantity
let currentView = 'menu';
let currentTab = MENU[0].id;

// ===== Ë®àÁÆó =====
function getKey(catId, itemName) { return `${catId}__${itemName}`; }

function getTotal() {
  return Object.entries(qty).reduce((sum, [key, q]) => {
    const [catId, itemName] = key.split('__');
    const cat = MENU.find(c => c.id === catId);
    if (!cat) return sum;
    const item = cat.items.find(i => i.name === itemName);
    if (!item) return sum;
    return sum + item.price * q;
  }, 0);
}

function getCartItems() {
  return Object.entries(qty)
    .filter(([_, q]) => q > 0)
    .map(([key, q]) => {
      const [catId, itemName] = key.split('__');
      const cat = MENU.find(c => c.id === catId);
      const item = cat.items.find(i => i.name === itemName);
      return { catId, itemName, price: item.price, qty: q, subtotal: item.price * q };
    });
}

function getTotalItemCount() {
  return Object.values(qty).reduce((s, q) => s + q, 0);
}

// ===== UI Êõ¥Êñ∞ =====
function updateTotal() {
  document.getElementById('totalAmount').textContent = getTotal();
}

function updateBadge() {
  const count = getTotalItemCount();
  const badge = document.getElementById('cartBadge');
  if (count > 0) {
    badge.textContent = count > 99 ? '99+' : count;
    badge.classList.add('show');
  } else {
    badge.classList.remove('show');
  }
}

function setQty(catId, itemName, val) {
  const key = getKey(catId, itemName);
  qty[key] = Math.max(0, val);
  updateTotal();
  updateBadge();
  // Update the specific card
  const card = document.querySelector(`[data-key="${key}"]`);
  if (card) {
    const display = card.querySelector('.qty-display');
    if (display) display.textContent = qty[key];
    if (qty[key] > 0) card.classList.add('has-qty');
    else card.classList.remove('has-qty');
  }
}

// ===== Ê∏≤ÊüìËèúÂñÆ =====
function renderMenu() {
  const tabsContainer = document.getElementById('tabsContainer');
  const mainContent = document.getElementById('mainContent');

  // Ê®ôÁ±§
  tabsContainer.innerHTML = MENU.map(cat => `
    <button class="tab ${cat.id === currentTab ? 'active' : ''}" onclick="switchTab('${cat.id}')">${cat.label}</button>
  `).join('');

  // ÂÖßÂÆπ
  mainContent.innerHTML = MENU.map(cat => `
    <div class="menu-section ${cat.id === currentTab ? 'active' : ''}" id="section-${cat.id}">
      ${cat.note ? `<div class="section-note">üìå ${cat.note}</div>` : ''}
      <div class="item-grid">
        ${cat.items.map(item => {
          const key = getKey(cat.id, item.name);
          const q = qty[key] || 0;
          return `
          <div class="item-card ${q > 0 ? 'has-qty' : ''}" data-key="${key}">
            <div class="item-name">${item.name}</div>
            <div class="item-price">${item.price}</div>
            <div class="qty-controls">
              <button class="qty-btn minus" onclick="setQty('${cat.id}', '${item.name.replace(/'/g, "\\'")}', ${q - 1})">‚àí</button>
              <span class="qty-display">${q}</span>
              <button class="qty-btn plus" onclick="setQty('${cat.id}', '${item.name.replace(/'/g, "\\'")}', ${q + 1})">+</button>
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>
  `).join('');
}

function renderCart() {
  const mainContent = document.getElementById('mainContent');
  const cartItems = getCartItems();
  const total = getTotal();

  if (cartItems.length === 0) {
    mainContent.innerHTML = `
      <div class="cart-section active">
        <div class="cart-empty">
          <div class="cart-empty-icon">üõí</div>
          <div>Â∞öÊú™ÈªûÈ§ê</div>
        </div>
      </div>`;
    return;
  }

  mainContent.innerHTML = `
    <div class="cart-section active">
      ${cartItems.map(ci => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${ci.itemName}</div>
            <div class="cart-item-detail">$${ci.price} √ó ${ci.qty}</div>
          </div>
          <div class="cart-item-subtotal">$${ci.subtotal}</div>
        </div>
      `).join('')}
      <div class="cart-total-row">
        <div class="cart-total-label">ÂêàË®à</div>
        <div class="cart-total-amount">$${total}</div>
      </div>
    </div>`;
}

function switchTab(tabId) {
  currentTab = tabId;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.menu-section').forEach(s => s.classList.remove('active'));
  const activeTab = document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`);
  if (activeTab) {
    activeTab.classList.add('active');
    activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }
  const section = document.getElementById(`section-${tabId}`);
  if (section) section.classList.add('active');
}

function switchView(view) {
  currentView = view;
  document.getElementById('navMenu').classList.toggle('active', view === 'menu');
  document.getElementById('navCart').classList.toggle('active', view === 'cart');
  document.getElementById('tabsWrapper').style.display = view === 'menu' ? 'block' : 'none';

  if (view === 'menu') {
    renderMenu();
  } else {
    renderCart();
  }
}

function clearAll() {
  if (!confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂìÅÈ†ÖÔºü')) return;
  Object.keys(qty).forEach(k => delete qty[k]);
  updateTotal();
  updateBadge();
  if (currentView === 'menu') renderMenu();
  else renderCart();
}

// ===== ÂàùÂßãÂåñ =====
function init() {
  renderMenu();

 }, { name: 'Ê≥ïÂúãÂêêÂè∏', price: 30 }, { name: 'Ë±¨ÊéíÂêêÂè∏', price: 30 },
      { name: 'È±àÈ≠öÂêêÂè∏', price: 35 }, { name: 'Ëä±ÊûùÂêêÂè∏', price: 35 },
      { name: 'ÂíîÂï¶ÈõûËÖøÂêêÂè∏ÔºàÂéüÂë≥Ôºâ', price: 45 }, { name: 'ÂíîÂï¶ÈõûËÖøÂêêÂè∏ÔºàËæ£Âë≥Ôºâ', price: 45 },
      { name: 'ÂçáÁ¥ö‰∏πÈ∫•', price: 20 },
    ]
  },
  {
    id: 'egg', label: 'ü•û ËõãÈ§Ö',
    items: [
      { name: 'ÂéüÂë≥ËõãÈ§Ö', price: 25 }, { name: 'ËÇâÈ¨ÜËõãÈ§Ö', price: 30 }, { name: 'ÁÅ´ËÖøËõãÈ§Ö', price: 30 },
      { name: 'ÁéâÁ±≥ËõãÈ§Ö', price: 30 }, { name: 'Ëî¨ËèúËõãÈ§Ö', price: 30 }, { name: 'Ëµ∑Âè∏ËõãÈ§Ö', price: 35 },
      { name: 'ÁÜ±ÁãóËõãÈ§Ö', price: 35 }, { name: 'ÂüπÊ†πËõãÈ§Ö', price: 35 }, { name: 'ÈÆ™È≠öËõãÈ§Ö', price: 35 },
      { name: 'ÁáªÈõûËõãÈ§Ö', price: 40 }, { name: 'Ê≥°ËèúËõãÈ§Ö', price: 40 }, { name: 'ËòøËîîÁ≥ïËõãÈ§Ö', price: 40 },
      { name: 'Ë±¨ÊéíËõãÈ§Ö', price: 45 }, { name: 'Ëè≤ÂäõÈõûËÖøËõãÈ§Ö', price: 50 }, { name: 'ÂíîÂï¶ÈõûËÖøËõãÈ§Ö', price: 60 },
    ]
  },
  {
    id: 'thick', label: 'üçû ÂéöÁâá',
    items: [
      { name: 'Â∑ßÂÖãÂäõÂéöÁâá', price: 20 }, { name: 'Ëä±ÁîüÂéöÁâá', price: 20 }, { name: 'ËçâËéìÂéöÁâá', price: 20 },
      { name: 'Â•∂ÈÖ•ÂéöÁâá', price: 20 }, { name: 'Â•∂Ê≤πÂéöÁâá', price: 20 }, { name: 'ÁÖâ‰π≥ÂéöÁâá', price: 20 },
      { name: 'ÁÅ´ËÖøÁéâÁ±≥ÂéöÁâá', price: 30 }, { name: 'ÁéâÁ±≥Ëµ∑Âè∏ÂéöÁâá', price: 35 },
      { name: 'ÈÆ™È≠öÁéâÁ±≥ÂéöÁâá', price: 35 }, { name: 'ÈÆ™È≠öËµ∑Âè∏ÂéöÁâá', price: 40 },
    ]
  },
  {
    id: 'box', label: 'üßá ÁõíÈÖ•',
    items: [
      { name: 'Â∑ßÂÖãÂäõÁõíÈÖ•', price: 20 }, { name: 'ËçâËéìÁõíÈÖ•', price: 20 }, { name: 'Ëä±ÁîüÁõíÈÖ•', price: 20 },
      { name: 'Â•∂Ê≤πÁõíÈÖ•', price: 20 }, { name: 'ÁÖâ‰π≥ÁõíÈÖ•', price: 20 }, { name: 'Â•∂ÈÖ•ÁõíÈÖ•', price: 20 },
      { name: 'ÁÅ´ËÖøÁõíÈÖ•', price: 20 }, { name: 'ÁéâÁ±≥ÁõíÈÖ•', price: 25 }, { name: 'Ëµ∑Âè∏ÁõíÈÖ•', price: 25 },
      { name: 'ÈÆ™È≠öÁõíÈÖ•', price: 25 }, { name: 'ÁéâÁ±≥ÈÆ™È≠öÁõíÈÖ•', price: 30 }, { name: 'ÁéâÁ±≥Ëµ∑Âè∏ÁõíÈÖ•', price: 30 },
      { name: 'ÈÆ™È≠öËµ∑Âè∏ÁõíÈÖ•', price: 35 }, { name: 'ÁáªÈõûÁõíÈÖ•', price: 30 }, { name: 'ËñØÁöÆÁõíÈÖ•', price: 45 },
    ]
  },
  {
    id: 'club', label: 'üåØ Á∏ΩÂåØ',
    items: [
      { name: 'Ë±¨ÊéíÁ∏ΩÂåØ', price: 60 }, { name: 'Á∏ΩÂåØÂêêÂè∏', price: 55 },
      { name: 'ÂíîÂï¶ÈõûËÖøÁ∏ΩÂåØ', price: 65 }, { name: 'Ëè≤ÂäõÈõûËÖøÁ∏ΩÂåØ', price: 65 },
    ]
  },
  {
    id: 'fried', label: 'üçü ÁèæÁÇ∏',
    items: [
      { name: 'È¶ôÈÖ•ÈõûÊü≥Ê¢ù', price: 10 }, { name: 'ËñØÈ§Ö', price: 15 }, { name: 'ËñØÊ¢ù', price: 20 },
      { name: 'È∫•ÂÖãÈõûÂ°ä', price: 25 }, { name: 'Â∞èÈõûÁêÉ', price: 25 },
    ]
  },
  {
    id: 'light', label: 'üåÆ ËºïÈ£ü',
    items: [
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÂ∑ßÂÖãÂäõÔºâ', price: 25 }, { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàËçâËéìÔºâ', price: 25 },
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàËä±ÁîüÔºâ', price: 25 }, { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÂ•∂ÈÖ•Ôºâ', price: 25 },
      { name: 'ÊûúÈÜ¨È¨ÜÈ§ÖÔºàÁÖâ‰π≥Ôºâ', price: 25 }, { name: 'Ëî¨Ëèú‰π≥ÈÖ™È§Ö', price: 30 },
      { name: 'ËõãËÇâÈ¨Ü‰π≥ÈÖ™È§Ö', price: 45 }, { name: 'ÈÆ™È≠öÁéâÁ±≥‰π≥ÈÖ™È§Ö', price: 40 },
    ]
  },
  {
    id: 'hot', label: 'üå≠ ÁÜ±È£ü',
    items: [
      { name: 'ÁÜ±ÁãóÔºà3Ê¢ùÔºâ', price: 15 }, { name: 'ÁÜ±ÁãóÂêêÂè∏ËõãÊç≤', price: 25 }, { name: 'ÁÜ±ÁãóÊç≤ËõãÔºà3Ê¢ùÔºâ', price: 30 },
      { name: 'Ëî•Ëõã', price: 15 }, { name: 'ÁéâÁ±≥Ëõã', price: 25 }, { name: 'Â∞èËÇâË±Ü', price: 20 },
      { name: 'ËòøËîîÁ≥ïÔºà2Â°äÔºâ', price: 25 }, { name: 'ËòøËîîÁ≥ïÔºà1Â°äÔºâ', price: 15 },
      { name: 'ÁîüÁÖéÂåÖ', price: 25 }, { name: '‰∏ÄÂè£ÁÖéÈ§É', price: 20 }, { name: 'ÈçãË≤º', price: 25 },
      { name: 'È¶ôÈÖ•ÁÖéÈ§É', price: 30 },
    ]
  },
  {
    id: 'noodle', label: 'üçú ÈçãÁáíÈ∫µ',
    items: [
      { name: 'ÊÑèÈ∫µ', price: 55 }, { name: 'ÂÜ¨Á≤â', price: 55 }, { name: 'ÈõûÁµ≤È∫µ', price: 55 }, { name: 'ÁÉèÈæçÈ∫µ', price: 55 },
      { name: 'Ê≥°ËèúÊÑèÈ∫µ', price: 70 }, { name: 'Ê≥°ËèúÂÜ¨Á≤â', price: 70 }, { name: 'Ê≥°ËèúÈõûÁµ≤È∫µ', price: 70 }, { name: 'Ê≥°ËèúÁÉèÈæçÈ∫µ', price: 70 },
    ]
  },
  {
    id: 'instant', label: 'üçú Ê≥°È∫µ',
    items: [
      { name: 'Ê≥°ËèúÊ≥°È∫µ', price: 70 }, { name: 'ËÇâÁá•Ê≥°È∫µ', price: 55 }, { name: 'ÁâõËÇâÊπØÊ≥°È∫µ', price: 55 },
    ]
  },
  {
    id: 'pasta', label: 'üçù Áæ©Â§ßÂà©È∫µ',
    items: [
      { name: 'ËåÑÊ±ÅÁæ©Â§ßÂà©È∫µ', price: 40 }, { name: 'ÈªëËÉ°Ê§íÁæ©Â§ßÂà©È∫µ', price: 40 },
    ]
  },
  {
    id: 'porridge', label: 'üç≤ Á≤•ÂìÅ',
    items: [
      { name: 'Âè∞ÂºèÈππÁ≤•', price: 50 }, { name: 'ÁöÆËõãÁò¶ËÇâÁ≤•', price: 60 },
    ]
  },
  {
    id: 'meat', label: 'ü•© ËÇâÊéíÂñÆÈªû',
    items: [
      { name: 'Êº¢Â†°ËÇâ', price: 10 }, { name: 'ÁáªÈõûËÇâ', price: 15 }, { name: 'Ë±¨Êéí', price: 20 },
      { name: 'È¶ôÁÉ§ÈõûËÖø', price: 25 }, { name: 'Ëè≤ÂäõÈõûÊéí', price: 25 }, { name: 'È±àÈ≠ö', price: 25 },
      { name: 'Ëù¶ËÇâ', price: 25 }, { name: 'Ëä±Êûù', price: 25 }, { name: 'ÂíîÂï¶ÈõûËÖøËÇâ', price: 35 },
    ]
  },
  {
    id: 'drink', label: 'ü•§ È£≤Êñô', note: 'ÂçáÁ¥öÂ§ßÊùØ +$5',
    items: [
      { name: 'Á¥ÖËå∂', price: 10 }, { name: 'Ë±ÜÊºø', price: 10 }, { name: 'Â•∂Ëå∂', price: 15 },
      { name: 'ÂíñÂï°ÁâõÂ•∂', price: 15 }, { name: 'ÂèØÂèØ', price: 15 }, { name: 'ÂÜ∞ÂèØÊ®Ç', price: 15 },
      { name: 'Êü≥Ê©ôÊ±Å', price: 15 }, { name: 'Ê™∏Ê™¨Á¥ÖËå∂', price: 15 }, { name: 'Ê∞¥ËúúÊ°ÉÊ±Å', price: 15 },
      { name: 'ÁôæÈ¶ôÊûúÊ±Å', price: 15 }, { name: 'ÈÆÆÂ•∂Ëå∂', price: 20 }, { name: 'ÈÆÆÂ•∂ÂíñÂï°ÔºàÂ§ßÊùØÔºâ', price: 30 },
      { name: 'ÂçáÁ¥öÂ§ßÊùØ', price: 5 },
    ]
  },
  {
    id: 'winter', label: '‚ùÑÔ∏è ÂÜ¨Â≠£ÈôêÂÆö',
    items: [
      { name: 'ÁéâÁ±≥ÊøÉÊπØÔºàÂ∞èÊùØÔºâ', price: 15 }, { name: 'ÁéâÁ±≥ÊøÉÊπØÔºàÂ§ßÊùØÔºâ', price: 25 },
    ]
  },
];

// ===== ÁãÄÊÖã =====
const qty = {}; // itemKey -> quantity
let currentView = 'menu';
let currentTab = MENU[0].id;

// ===== Ë®àÁÆó =====
function getKey(catId, itemName) { return `${catId}__${itemName}`; }

function getTotal() {
  return Object.entries(qty).reduce((sum, [key, q]) => {
    const [catId, itemName] = key.split('__');
    const cat = MENU.find(c => c.id === catId);
    if (!cat) return sum;
    const item = cat.items.find(i => i.name === itemName);
    if (!item) return sum;
    return sum + item.price * q;
  }, 0);
}

function getCartItems() {
  return Object.entries(qty)
    .filter(([_, q]) => q > 0)
    .map(([key, q]) => {
      const [catId, itemName] = key.split('__');
      const cat = MENU.find(c => c.id === catId);
      const item = cat.items.find(i => i.name === itemName);
      return { catId, itemName, price: item.price, qty: q, subtotal: item.price * q };
    });
}

function getTotalItemCount() {
  return Object.values(qty).reduce((s, q) => s + q, 0);
}

// ===== UI Êõ¥Êñ∞ =====
function updateTotal() {
  document.getElementById('totalAmount').textContent = getTotal();
}

function updateBadge() {
  const count = getTotalItemCount();
  const badge = document.getElementById('cartBadge');
  if (count > 0) {
    badge.textContent = count > 99 ? '99+' : count;
    badge.classList.add('show');
  } else {
    badge.classList.remove('show');
  }
}

function setQty(catId, itemName, val) {
  const key = getKey(catId, itemName);
  qty[key] = Math.max(0, val);
  updateTotal();
  updateBadge();
  // Update the specific card
  const card = document.querySelector(`[data-key="${key}"]`);
  if (card) {
    const display = card.querySelector('.qty-display');
    if (display) display.textContent = qty[key];
    if (qty[key] > 0) card.classList.add('has-qty');
    else card.classList.remove('has-qty');
  }
}

// ===== Ê∏≤ÊüìËèúÂñÆ =====
function renderMenu() {
  const tabsContainer = document.getElementById('tabsContainer');
  const mainContent = document.getElementById('mainContent');

  // Ê®ôÁ±§
  tabsContainer.innerHTML = MENU.map(cat => `
    <button class="tab ${cat.id === currentTab ? 'active' : ''}" onclick="switchTab('${cat.id}')">${cat.label}</button>
  `).join('');

  // ÂÖßÂÆπ
  mainContent.innerHTML = MENU.map(cat => `
    <div class="menu-section ${cat.id === currentTab ? 'active' : ''}" id="section-${cat.id}">
      ${cat.note ? `<div class="section-note">üìå ${cat.note}</div>` : ''}
      <div class="item-grid">
        ${cat.items.map(item => {
          const key = getKey(cat.id, item.name);
          const q = qty[key] || 0;
          return `
          <div class="item-card ${q > 0 ? 'has-qty' : ''}" data-key="${key}">
            <div class="item-name">${item.name}</div>
            <div class="item-price">${item.price}</div>
            <div class="qty-controls">
              <button class="qty-btn minus" onclick="setQty('${cat.id}', '${item.name.replace(/'/g, "\\'")}', ${q - 1})">‚àí</button>
              <span class="qty-display">${q}</span>
              <button class="qty-btn plus" onclick="setQty('${cat.id}', '${item.name.replace(/'/g, "\\'")}', ${q + 1})">+</button>
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>
  `).join('');
}

function renderCart() {
  const mainContent = document.getElementById('mainContent');
  const cartItems = getCartItems();
  const total = getTotal();

  if (cartItems.length === 0) {
    mainContent.innerHTML = `
      <div class="cart-section active">
        <div class="cart-empty">
          <div class="cart-empty-icon">üõí</div>
          <div>Â∞öÊú™ÈªûÈ§ê</div>
        </div>
      </div>`;
    return;
  }

  mainContent.innerHTML = `
    <div class="cart-section active">
      ${cartItems.map(ci => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${ci.itemName}</div>
            <div class="cart-item-detail">$${ci.price} √ó ${ci.qty}</div>
          </div>
          <div class="cart-item-subtotal">$${ci.subtotal}</div>
        </div>
      `).join('')}
      <div class="cart-total-row">
        <div class="cart-total-label">ÂêàË®à</div>
        <div class="cart-total-amount">$${total}</div>
      </div>
    </div>`;
}

function switchTab(tabId) {
  currentTab = tabId;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.menu-section').forEach(s => s.classList.remove('active'));
  const activeTab = document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`);
  if (activeTab) {
    activeTab.classList.add('active');
    activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }
  const section = document.getElementById(`section-${tabId}`);
  if (section) section.classList.add('active');
}

function switchView(view) {
  currentView = view;
  document.getElementById('navMenu').classList.toggle('active', view === 'menu');
  document.getElementById('navCart').classList.toggle('active', view === 'cart');
  document.getElementById('tabsWrapper').style.display = view === 'menu' ? 'block' : 'none';

  if (view === 'menu') {
    renderMenu();
  } else {
    renderCart();
  }
}

function clearAll() {
  if (!confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂìÅÈ†ÖÔºü')) return;
  Object.keys(qty).forEach(k => delete qty[k]);
  updateTotal();
  updateBadge();
  if (currentView === 'menu') renderMenu();
  else renderCart();
}

// ===== ÂàùÂßãÂåñ =====
function init() {
  renderMenu();

