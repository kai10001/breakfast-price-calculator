<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾è€Œç¾æ—©é¤ï¼ˆå—èˆˆåº—ï¼‰- æ™ºæ…§é»é¤ç³»çµ±</title>
    <style>
        :root {
            --primary: #f39c12;
            --secondary: #d35400;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333333;
            --light-gray: #e9ecef;
            --border-color: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 0;
            /* é è¨­æ‰‹æ©Ÿç‰ˆé˜²æ²å‹•æŠ–å‹• */
            overflow-x: hidden;
        }

        /* ç³»çµ±ä¸»è¦æ¶æ§‹ */
        .app-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* å·¦å´ä¸»ç•«é¢å€å¡Š */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-top: 110px; /* æ‰‹æ©Ÿç‰ˆ Header ç©ºé–“ */
            padding-bottom: 70px; /* æ‰‹æ©Ÿç‰ˆ Bottom Bar ç©ºé–“ */
        }

        /* é ‚éƒ¨å€å¡Š (æ‰‹æ©Ÿç‰ˆå›ºå®šï¼Œå¹³æ¿éœæ…‹) */
        .header-container {
            position: fixed;
            top: 0; left: 0; width: 100%;
            background: #fff;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        header {
            background-color: var(--primary);
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            letter-spacing: 1px;
        }

        /* åˆ†é¡æ¨™ç±¤ */
        .category-tabs {
            display: flex;
            overflow-x: auto;
            padding: 10px 15px;
            white-space: nowrap;
            scrollbar-width: none;
        }
        .category-tabs::-webkit-scrollbar { display: none; }
        .category-tab {
            padding: 8px 16px;
            margin-right: 10px;
            background: var(--light-gray);
            color: #555;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }
        .category-tab.active { background: var(--secondary); color: white; }

        /* é¤é»åˆ—è¡¨ */
        .item-list {
            padding: 10px 15px;
            flex: 1;
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 15px;
            margin-bottom: 12px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .menu-item:active { transform: scale(0.98); background: #fafafa; }
        .item-name { font-weight: 600; color: #222; line-height: 1.4; }
        .item-price { color: var(--secondary); font-weight: 700; font-size: 1.15rem; }

        /* å³å´è³¼ç‰©è»Š (å¹³æ¿/é›»è…¦å°ˆç”¨ï¼Œé è¨­éš±è—) */
        .desktop-cart { display: none; }

        /* åº•éƒ¨æ‡¸æµ®è³¼ç‰©è»Šåˆ— (æ‰‹æ©Ÿå°ˆç”¨) */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 65px;
            background: var(--text); color: white;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; font-size: 1.1rem; z-index: 20; cursor: pointer;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .cart-info { display: flex; align-items: center; gap: 10px; }
        .cart-badge {
            background: var(--primary); color: white; border-radius: 50%;
            width: 28px; height: 28px; display: flex; justify-content: center; align-items: center;
            font-size: 0.9rem; font-weight: bold;
        }
        .bottom-total { font-weight: bold; font-size: 1.3rem; }

        /* å…±ç”¨ Modal é®ç½© */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100;
            flex-direction: column; justify-content: flex-end; /* æ‰‹æ©Ÿç‰ˆå¾åº•éƒ¨ */
        }
        
        /* åŠ æ–™èˆ‡æ•¸é‡ Modal (æ‰‹æ©Ÿç‰ˆ Bottom Sheet) */
        .bottom-sheet {
            background: white; padding: 25px 20px 35px 20px;
            border-radius: 20px 20px 0 0;
            animation: slideUp 0.3s ease-out forwards;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .modal-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 20px; color: var(--secondary); border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .addon-group { margin-bottom: 20px; max-height: 30vh; overflow-y: auto; }
        .addon-label { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 1.1rem; cursor: pointer; }
        .addon-label input { margin-right: 12px; transform: scale(1.3); }

        .qty-group { display: flex; justify-content: center; align-items: center; margin: 25px 0; gap: 20px; }
        .qty-btn { background: var(--light-gray); border: none; border-radius: 50%; width: 45px; height: 45px; font-size: 1.5rem; color: #555; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .qty-input { width: 50px; text-align: center; font-size: 1.5rem; border: none; background: transparent; font-weight: bold; }

        .modal-actions { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        .btn-cancel { background: var(--light-gray); color: #555; }
        .btn-confirm { background: var(--primary); color: white; }

        /* è³¼ç‰©è»Š Modal (æ‰‹æ©Ÿç‰ˆå°ˆç”¨) */
        .cart-modal {
            background: var(--bg-color); height: 90vh; border-radius: 20px 20px 0 0;
            display: flex; flex-direction: column; animation: slideUp 0.3s ease-out forwards;
        }
        .cart-header { padding: 20px; background: white; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; border-radius: 20px 20px 0 0; }
        .cart-title { font-size: 1.3rem; font-weight: bold; }
        .close-btn { background: none; border: none; font-size: 1.5rem; color: #888; padding: 0 10px; cursor: pointer; }
        
        .cart-items { flex: 1; overflow-y: auto; padding: 15px; }
        .cart-item { background: white; padding: 15px; margin-bottom: 12px; border-radius: 12px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .cart-item-title { font-weight: bold; font-size: 1.1rem; padding-right: 50px; line-height: 1.3; }
        .cart-item-details { font-size: 0.9rem; color: #777; margin-top: 6px; }
        .cart-item-price { font-weight: bold; color: var(--secondary); margin-top: 8px; font-size: 1.1rem;}
        .remove-btn { position: absolute; top: 15px; right: 15px; background: #ffebe6; color: #e74c3c; border: none; border-radius: 8px; padding: 6px 12px; font-size: 0.9rem; font-weight: bold; cursor: pointer; }

        .cart-footer { background: white; padding: 20px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .cart-total-row { display: flex; justify-content: space-between; font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; }
        .copy-btn { width: 100%; background: #2ecc71; color: white; padding: 15px; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: bold; display: flex; justify-content: center; align-items: center; gap: 8px; cursor: pointer; }
        .clear-btn { width: 100%; background: transparent; color: #999; padding: 10px; border: none; margin-top: 10px; font-size: 1rem; cursor: pointer; }


        /* =========================================
           å¹³æ¿èˆ‡é›»è…¦ç‰ˆæ·±åº¦æœ€ä½³åŒ– (min-width: 768px) 
           ========================================= */
        @media (min-width: 768px) {
            body { 
                height: 100vh; /* é–å®šå…¨å±€æ»¾å‹•ï¼Œç”±å…§éƒ¨å€å¡Šè‡ªå¸¶æ»¾å‹• */
                overflow: hidden; 
            }
            .app-wrapper { 
                flex-direction: row; /* å·¦å³åˆ†è²è¨­è¨ˆ */
                height: 100vh;
            }
            
            /* å·¦å´é¤é»å€ */
            .main-content {
                padding: 0; 
                flex: 1;
                height: 100vh;
                background: var(--bg-color);
            }
            
            /* é ‚éƒ¨è§£é™¤ Fixedï¼Œéš¨ä½ˆå±€è‡ªç„¶æµå‹• */
            .header-container { 
                position: static; 
                box-shadow: none; 
                border-bottom: 1px solid var(--border-color);
                flex-shrink: 0;
            }
            header { font-size: 1.4rem; padding: 15px; }
            
            /* ã€é‡é»ã€‘åˆ†é¡æ¨™ç±¤è‡ªå‹•æ›è¡Œï¼Œä¸éœ€æ©«å‘æ»‘å‹• */
            .category-tabs { 
                flex-wrap: wrap; 
                padding: 15px; 
                gap: 8px; 
                height: auto;
                background: #fff;
            }
            .category-tab { margin: 0; font-size: 1rem; padding: 10px 18px; }
            .category-tab:hover { background: #e0e0e0; }
            .category-tab.active:hover { background: var(--secondary); }

            /* ã€é‡é»ã€‘ç¶²æ ¼åŒ–é¤é»å¡ç‰‡ï¼Œæå‡è¢å¹•è³‡è¨Šå¯†åº¦ */
            .item-list { 
                flex: 1; 
                overflow-y: auto; 
                display: grid; 
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
                gap: 15px; 
                align-content: start; 
                padding: 20px; 
            }
            .menu-item { 
                margin-bottom: 0; 
                flex-direction: column; 
                align-items: flex-start; 
                justify-content: space-between;
                height: 120px; 
                padding: 15px;
            }
            .menu-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: var(--primary); transform: translateY(-2px); }
            .item-name { font-size: 1.2rem; }
            .item-price { align-self: flex-start; font-size: 1.25rem; }

            /* ã€é‡é»ã€‘å³å´å¸¸é§è³¼ç‰©è»Šé¢æ¿ */
            .desktop-cart { 
                display: flex; 
                flex-direction: column; 
                width: 380px; 
                background: white; 
                border-left: 1px solid var(--border-color);
                box-shadow: -2px 0 15px rgba(0,0,0,0.03);
                z-index: 5;
            }
            .desktop-cart-header {
                padding: 20px; background: var(--primary); color: white;
                font-size: 1.3rem; font-weight: bold; text-align: center;
            }
            
            /* éš±è—æ‰‹æ©Ÿç‰ˆå°ˆç”¨å…ƒç´  */
            .bottom-bar { display: none !important; }

            /* ã€é‡é»ã€‘åŠ æ–™è¦–çª—æ”¹ç‚ºå±…ä¸­å½ˆçª—ï¼Œæå‡å¤§è¢å¹•é«”é©— */
            .modal-overlay { justify-content: center; align-items: center; padding: 20px; }
            .bottom-sheet { 
                border-radius: 20px; width: 100%; max-width: 450px; 
                animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
                transform: scale(0.9); opacity: 0; 
                padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            @keyframes popIn { to { transform: scale(1); opacity: 1; } }
            
            /* å„ªåŒ–å¹³æ¿è¦–çª—å…§çš„å…ƒç´  */
            .qty-btn { transition: 0.2s; }
            .qty-btn:hover { background: #ddd; }
            .btn:hover { opacity: 0.9; transform: translateY(-1px); }
            .copy-btn:hover { background: #27ae60; }
        }
    </style>
</head>
<body>

    <div class="app-wrapper">
        <!-- ================= å·¦å´/ä¸»è¦ å…§å®¹å€ ================= -->
        <main class="main-content">
            <div class="header-container">
                <header>ç¾è€Œç¾ï¼ˆå—èˆˆåº—ï¼‰é»é¤æ©Ÿ</header>
                <!-- åˆ†é¡æ»‘å‹•/æ›è¡Œå€ -->
                <div class="category-tabs" id="categoryTabs"></div>
            </div>

            <!-- é¤é»åˆ—è¡¨å€ (ç¶²æ ¼æˆ–ç›´åˆ—) -->
            <div class="item-list" id="itemList"></div>
        </main>

        <!-- ================= å³å´ å¸¸é§è³¼ç‰©è»Š (å¹³æ¿/é›»è…¦ç‰ˆ) ================= -->
        <aside class="desktop-cart">
            <div class="desktop-cart-header">ç›®å‰è¨‚å–®æ˜ç´°</div>
            <div class="cart-items" id="desktopCartItems">
                <!-- ç”± JS æ¸²æŸ“ -->
            </div>
            <div class="cart-footer">
                <div class="cart-total-row">
                    <span>ç¸½è¨ˆé‡‘é¡</span>
                    <span style="color: var(--secondary);">$<span id="desktopCartTotalPrice">0</span></span>
                </div>
                <button class="copy-btn" onclick="copyOrder()">ğŸ“‹ ä¸€éµè¤‡è£½è¨‚å–® (å‚³çµ¦è€é—†)</button>
                <button class="clear-btn" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
            </div>
        </aside>
    </div>

    <!-- ================= åº•éƒ¨æ‡¸æµ®è³¼ç‰©è»Š (æ‰‹æ©Ÿç‰ˆå°ˆç”¨) ================= -->
    <div class="bottom-bar" id="bottomBar" onclick="openMobileCartModal()" style="display: none;">
        <div class="cart-info">
            <div class="cart-badge" id="bottomCount">0</div>
            <span>æŸ¥çœ‹è³¼ç‰©è»Š</span>
        </div>
        <div class="bottom-total">$<span id="bottomTotal">0</span></div>
    </div>

    <!-- ================= äº’å‹• Modal å€åŸŸ ================= -->
    
    <!-- é¸æ“‡åŠ æ–™èˆ‡æ•¸é‡ Modal (æ‰‹æ©Ÿåº•éƒ¨/å¹³æ¿å±…ä¸­) -->
    <div class="modal-overlay" id="itemModal" onclick="closeModal(event, 'itemModal')">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="modal-title" id="modalTitle">é¤é»åç¨±</div>
            
            <div id="modalAddons" class="addon-group"></div>

            <div class="qty-group">
                <button class="qty-btn" onclick="changeQty(-1)">-</button>
                <input type="text" id="modalQty" class="qty-input" value="1" readonly>
                <button class="qty-btn" onclick="changeQty(1)">+</button>
            </div>

            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeModal(null, 'itemModal')">å–æ¶ˆ</button>
                <button class="btn btn-confirm" onclick="confirmAddToCart()">åŠ å…¥æ¸…å–® $<span id="modalCurrentTotal">0</span></button>
            </div>
        </div>
    </div>

    <!-- æ‰‹æ©Ÿç‰ˆå°ˆå±¬è³¼ç‰©è»Š Modal -->
    <div class="modal-overlay" id="mobileCartModal" onclick="closeModal(event, 'mobileCartModal')">
        <div class="cart-modal" onclick="event.stopPropagation()">
            <div class="cart-header">
                <span class="cart-title">è³¼ç‰©è»Šæ˜ç´°</span>
                <button class="close-btn" onclick="closeModal(null, 'mobileCartModal')">âœ•</button>
            </div>
            <div class="cart-items" id="mobileCartItems"></div>
            <div class="cart-footer">
                <div class="cart-total-row">
                    <span>ç¸½é‡‘é¡</span>
                    <span style="color: var(--secondary);">$<span id="mobileCartTotalPrice">0</span></span>
                </div>
                <button class="copy-btn" onclick="copyOrder()">ğŸ“‹ ä¸€éµè¤‡è£½è¨‚å–®</button>
                <button class="clear-btn" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
            </div>
        </div>
    </div>

    <script>
        // --- å®Œæ•´èœå–®è³‡æ–™åº« ---
        const menuData = [
            {
                category: "ğŸ¥ª æ¼¢å ¡é¡",
                addons: [{ name: "åŠ è›‹", price: 15 }, { name: "åŠ èµ·å¸", price: 10 }],
                items: [
                    { name: "æ¼¢å ¡", price: 25 }, { name: "è›‹å ¡", price: 30 }, { name: "é®ªé­šå ¡", price: 25 },
                    { name: "é›è‚‰å ¡", price: 30 }, { name: "ç‡»é›å ¡", price: 30 }, { name: "èŠ±æå ¡", price: 35 },
                    { name: "é±ˆé­šå ¡", price: 35 }, { name: "è¦è‚‰å ¡", price: 35 }, { name: "è±¬æ’å ¡", price: 35 },
                    { name: "é¦™çƒ¤é›è…¿å ¡", price: 35 }, { name: "è²åŠ›é›è…¿å ¡", price: 35 }, { name: "å’”å•¦é›è…¿å ¡(åŸå‘³)", price: 45 }, { name: "å’”å•¦é›è…¿å ¡(è¾£å‘³)", price: 45 }
                ]
            },
            {
                category: "ğŸ çƒ¤åå¸",
                addons: [{ name: "å‡ç´šä¸¹éº¥åå¸", price: 20 }],
                items: [
                    { name: "å·§å…‹åŠ›åå¸", price: 10 }, { name: "è‰è“åå¸", price: 10 }, { name: "èŠ±ç”Ÿåå¸", price: 10 },
                    { name: "å¥¶æ²¹åå¸(é¹¹)", price: 10 }, { name: "ç…‰ä¹³åå¸(ç”œ)", price: 10 }, { name: "å¥¶é…¥åå¸", price: 15 },
                    { name: "è‚‰é¬†åå¸", price: 15 }, { name: "ç‰ç±³åå¸", price: 15 }, { name: "ç«è…¿åå¸", price: 15 },
                    { name: "ç‡»é›åå¸", price: 20 }, { name: "åŸ¹æ ¹åå¸", price: 20 }, { name: "é®ªé­šåå¸", price: 20 },
                    { name: "ç…è›‹åå¸", price: 25 }, { name: "æ³•åœ‹åå¸", price: 30 }, { name: "è±¬æ’åå¸", price: 30 },
                    { name: "é±ˆé­šåå¸", price: 35 }, { name: "èŠ±æåå¸", price: 35 }, { name: "å’”å•¦é›è…¿åå¸(åŸ/è¾£)", price: 45 }
                ]
            },
            { category: "ğŸ¥ è›‹é¤…", items: [{ name: "åŸå‘³è›‹é¤…", price: 25 }, { name: "è‚‰é¬†è›‹é¤…", price: 30 }, { name: "ç«è…¿è›‹é¤…", price: 30 }, { name: "ç‰ç±³è›‹é¤…", price: 30 }, { name: "è”¬èœè›‹é¤…", price: 30 }, { name: "èµ·å¸è›‹é¤…", price: 35 }, { name: "ç†±ç‹—è›‹é¤…", price: 35 }, { name: "åŸ¹æ ¹è›‹é¤…", price: 35 }, { name: "é®ªé­šè›‹é¤…", price: 35 }, { name: "ç‡»é›è›‹é¤…", price: 40 }, { name: "æ³¡èœè›‹é¤…", price: 40 }, { name: "è˜¿è””ç³•è›‹é¤…", price: 40 }, { name: "è±¬æ’è›‹é¤…", price: 45 }, { name: "è²åŠ›é›è…¿è›‹é¤…", price: 50 }, { name: "å’”å•¦é›è…¿è›‹é¤…", price: 60 }] },
            { category: "ğŸ åšç‰‡", items: [{ name: "å·§å…‹åŠ›åšç‰‡", price: 20 }, { name: "èŠ±ç”Ÿåšç‰‡", price: 20 }, { name: "è‰è“åšç‰‡", price: 20 }, { name: "å¥¶é…¥åšç‰‡", price: 20 }, { name: "å¥¶æ²¹åšç‰‡(é¹¹)", price: 20 }, { name: "ç…‰ä¹³åšç‰‡(ç”œ)", price: 20 }, { name: "ç«è…¿ç‰ç±³åšç‰‡", price: 30 }, { name: "ç‰ç±³èµ·å¸åšç‰‡", price: 35 }, { name: "é®ªé­šç‰ç±³åšç‰‡", price: 35 }, { name: "é®ªé­šèµ·å¸åšç‰‡", price: 40 }] },
            { category: "ğŸ§‡ ç›’é…¥", items: [{ name: "å·§å…‹åŠ›ç›’é…¥", price: 20 }, { name: "è‰è“ç›’é…¥", price: 20 }, { name: "èŠ±ç”Ÿç›’é…¥", price: 20 }, { name: "å¥¶æ²¹ç›’é…¥(é¹¹)", price: 20 }, { name: "ç…‰ä¹³ç›’é…¥(ç”œ)", price: 20 }, { name: "å¥¶é…¥ç›’é…¥", price: 20 }, { name: "ç«è…¿ç›’é…¥", price: 20 }, { name: "ç‰ç±³ç›’é…¥", price: 25 }, { name: "èµ·å¸ç›’é…¥", price: 25 }, { name: "é®ªé­šç›’é…¥", price: 25 }, { name: "ç‡»é›ç›’é…¥", price: 30 }, { name: "ç‰ç±³é®ªé­šç›’é…¥", price: 30 }, { name: "ç‰ç±³èµ·å¸ç›’é…¥", price: 30 }, { name: "é®ªé­šèµ·å¸ç›’é…¥", price: 35 }, { name: "è–¯çš®ç›’é…¥", price: 45 }] },
            { category: "ğŸŒ¯ ç¸½åŒ¯", items: [{ name: "ç¸½åŒ¯åå¸", price: 55 }, { name: "è±¬æ’ç¸½åŒ¯", price: 60 }, { name: "å’”å•¦é›è…¿ç¸½åŒ¯", price: 65 }, { name: "è²åŠ›é›è…¿ç¸½åŒ¯", price: 65 }] },
            { category: "ğŸŸ ç‚¸ç‰©", items: [{ name: "é¦™é…¥é›æŸ³æ¢", price: 10 }, { name: "è–¯é¤…", price: 15 }, { name: "è–¯æ¢", price: 20 }, { name: "éº¥å…‹é›å¡Š", price: 25 }, { name: "å°é›çƒ", price: 25 }] },
            { category: "ğŸŒ® è¼•é£Ÿ", items: [{ name: "æœé†¬é¬†é¤…(å·§/è‰/èŠ±/å¥¶/ç…‰)", price: 25 }, { name: "è”¬èœä¹³é…ªé¤…", price: 30 }, { name: "é®ªé­šç‰ç±³ä¹³é…ªé¤…", price: 40 }, { name: "è›‹è‚‰é¬†ä¹³é…ªé¤…", price: 45 }] },
            { category: "ğŸŒ­ ç†±é£Ÿ", items: [{ name: "ç†±ç‹—(3æ¢)", price: 15 }, { name: "è”¥è›‹", price: 15 }, { name: "è˜¿è””ç³•(å–®å¡Š)", price: 15 }, { name: "å°è‚‰è±†", price: 20 }, { name: "ä¸€å£ç…é¤ƒ", price: 20 }, { name: "ç†±ç‹—åå¸è›‹æ²", price: 25 }, { name: "ç‰ç±³è›‹", price: 25 }, { name: "è˜¿è””ç³•(2å¡Š)", price: 25 }, { name: "ç”Ÿç…åŒ…", price: 25 }, { name: "é‹è²¼", price: 25 }, { name: "ç†±ç‹—æ²è›‹(3æ¢)", price: 30 }, { name: "é¦™é…¥ç…é¤ƒ", price: 30 }] },
            { category: "ğŸœ éºµé£Ÿ", items: [{ name: "èŒ„æ±ç¾©å¤§åˆ©éºµ", price: 40 }, { name: "é»‘èƒ¡æ¤’ç¾©å¤§åˆ©éºµ", price: 40 }, { name: "æ„éºµ", price: 55 }, { name: "å†¬ç²‰", price: 55 }, { name: "é›çµ²éºµ", price: 55 }, { name: "çƒé¾éºµ", price: 55 }, { name: "è‚‰ç‡¥æ³¡éºµ", price: 55 }, { name: "ç‰›è‚‰æ¹¯æ³¡éºµ", price: 55 }, { name: "æ³¡èœæ„éºµ", price: 70 }, { name: "æ³¡èœå†¬ç²‰", price: 70 }, { name: "æ³¡èœé›çµ²éºµ", price: 70 }, { name: "æ³¡èœçƒé¾éºµ", price: 70 }, { name: "æ³¡èœæ³¡éºµ", price: 70 }] },
            { category: "ğŸ² ç²¥å“", items: [{ name: "å°å¼é¹¹ç²¥", price: 50 }, { name: "çš®è›‹ç˜¦è‚‰ç²¥", price: 60 }] },
            { category: "ğŸ¥© å–®é»", items: [{ name: "æ¼¢å ¡è‚‰", price: 10 }, { name: "ç‡»é›è‚‰", price: 15 }, { name: "è±¬æ’", price: 20 }, { name: "é¦™çƒ¤é›è…¿", price: 25 }, { name: "è²åŠ›é›æ’", price: 25 }, { name: "é±ˆé­š", price: 25 }, { name: "è¦è‚‰", price: 25 }, { name: "èŠ±æ", price: 25 }, { name: "å’”å•¦é›è…¿è‚‰", price: 35 }] },
            {
                category: "ğŸ¥¤ é£²å“èˆ‡æ¹¯",
                addons: [{ name: "æº«/ç†±", price: 0 }, { name: "å‡ç´šå¤§æ¯", price: 5 }],
                items: [
                    { name: "ç´…èŒ¶", price: 10 }, { name: "è±†æ¼¿", price: 10 }, { name: "å¥¶èŒ¶", price: 15 }, { name: "å’–å•¡ç‰›å¥¶", price: 15 }, { name: "å¯å¯", price: 15 }, { name: "å†°å¯æ¨‚", price: 15 }, { name: "æŸ³æ©™æ±", price: 15 }, { name: "æª¸æª¬ç´…èŒ¶", price: 15 }, { name: "æ°´èœœæ¡ƒæ±", price: 15 }, { name: "ç™¾é¦™æœæ±", price: 15 }, { name: "ç‰ç±³æ¿ƒæ¹¯(å°)", price: 15 }, { name: "é®®å¥¶èŒ¶", price: 20 }, { name: "ç‰ç±³æ¿ƒæ¹¯(å¤§)", price: 25 }, { name: "é®®å¥¶å’–å•¡(å¤§æ¯)", price: 30 }
                ]
            }
        ];

        let cart = [];
        let tempItem = null; 

        // --- åˆå§‹åŒ– UI ---
        function init() {
            renderCategoryTabs();
            renderItems(0);
            updateCartDisplay(); // ç¢ºä¿åˆå§‹ç‹€æ…‹æ¡Œé¢ç‰ˆæœ‰é¡¯ç¤º"ç©ºçš„è³¼ç‰©è»Š"
        }

        // æ¸²æŸ“åˆ†é¡åˆ—
        function renderCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = '';
            menuData.forEach((cat, index) => {
                const btn = document.createElement('button');
                btn.className = `category-tab ${index === 0 ? 'active' : ''}`;
                // ç°¡åŒ–åˆ†é¡æ–‡å­— (ç§»é™¤è¡¨æƒ…ç¬¦è™Ÿå‰çš„å­—)
                btn.innerText = cat.category.includes(' ') ? cat.category.split(' ')[1] : cat.category.substring(2);
                btn.onclick = () => {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    btn.classList.add('active');
                    renderItems(index);
                    
                    // æ‰‹æ©Ÿç‰ˆé»æ“Šå¾Œï¼Œèœå–®åˆ—è¡¨è‡ªå‹•æ»¾å›é ‚éƒ¨
                    const itemList = document.getElementById('itemList');
                    if (window.innerWidth < 768) {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        itemList.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                };
                tabsContainer.appendChild(btn);
            });
        }

        // æ¸²æŸ“é¤é»æ¸…å–®
        function renderItems(index) {
            const listContainer = document.getElementById('itemList');
            listContainer.innerHTML = '';
            const category = menuData[index];

            category.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerHTML = `
                    <span class="item-name">${item.name}</span>
                    <span class="item-price">$${item.price}</span>
                `;
                div.onclick = () => openItemModal(item, category.addons || []);
                listContainer.appendChild(div);
            });
        }

        // --- é»é¤åŠ æ–™ Modal é‚è¼¯ ---
        function openItemModal(item, addons) {
            tempItem = { ...item, selectedAddons: [], qty: 1 };
            document.getElementById('modalTitle').innerText = item.name;
            document.getElementById('modalQty').value = 1;
            
            const addonsContainer = document.getElementById('modalAddons');
            addonsContainer.innerHTML = '';
            
            if (addons.length > 0) {
                addons.forEach((addon, idx) => {
                    addonsContainer.innerHTML += `
                        <label class="addon-label">
                            <input type="checkbox" onchange="updateModalPrice(this, ${addon.price}, '${addon.name}')"> 
                            ${addon.name} <span style="color:#888; margin-left:5px; font-size:0.95rem;">${addon.price > 0 ? '(+$' + addon.price + ')' : ''}</span>
                        </label>
                    `;
                });
            }

            updateModalDisplayPrice();
            document.getElementById('itemModal').style.display = 'flex';
        }

        function changeQty(amount) {
            let qty = parseInt(document.getElementById('modalQty').value);
            qty += amount;
            if (qty < 1) qty = 1;
            document.getElementById('modalQty').value = qty;
            tempItem.qty = qty;
            updateModalDisplayPrice();
        }

        function updateModalPrice(checkbox, price, name) {
            if (checkbox.checked) {
                tempItem.selectedAddons.push({ name, price });
            } else {
                tempItem.selectedAddons = tempItem.selectedAddons.filter(a => a.name !== name);
            }
            updateModalDisplayPrice();
        }

        function updateModalDisplayPrice() {
            let addonTotal = tempItem.selectedAddons.reduce((sum, a) => sum + a.price, 0);
            let total = (tempItem.price + addonTotal) * tempItem.qty;
            document.getElementById('modalCurrentTotal').innerText = total;
        }

        function confirmAddToCart() {
            cart.push(tempItem);
            updateCartDisplay();
            closeModal(null, 'itemModal');
            
            // å‹•ç•«å›é¥‹ï¼šæ‰‹æ©Ÿç‰ˆå½ˆè·³ bottom bar
            if(window.innerWidth < 768) {
                const bottomBar = document.getElementById('bottomBar');
                bottomBar.style.transform = 'scale(1.05)';
                setTimeout(() => bottomBar.style.transform = 'scale(1)', 200);
            }
        }

        // --- è³¼ç‰©è»Šèˆ‡ UI åŒæ­¥é‚è¼¯ (æ‰‹æ©Ÿ/å¹³æ¿å…±ç”¨) ---
        function updateCartDisplay() {
            let grandTotal = 0;
            let totalQty = 0;
            let cartHtml = '';

            if (cart.length === 0) {
                cartHtml = '<div style="text-align:center; color:#999; margin-top:50px; font-size: 1.1rem;">ç›®å‰è³¼ç‰©è»Šæ˜¯ç©ºçš„å”·</div>';
                // æ‰‹æ©Ÿç‰ˆéš±è— bottom bar
                document.getElementById('bottomBar').style.display = 'none';
            } else {
                // æ‰‹æ©Ÿç‰ˆé¡¯ç¤º bottom bar
                document.getElementById('bottomBar').style.display = 'flex';
                
                cart.forEach((item, index) => {
                    let addonTotal = item.selectedAddons.reduce((sum, a) => sum + a.price, 0);
                    let itemTotal = (item.price + addonTotal) * item.qty;
                    grandTotal += itemTotal;
                    totalQty += item.qty;

                    let addonText = item.selectedAddons.length > 0 
                        ? `<div class="cart-item-details">${item.selectedAddons.map(a => a.name).join(', ')}</div>` 
                        : '';

                    cartHtml += `
                        <div class="cart-item">
                            <button class="remove-btn" onclick="removeFromCart(${index})">åˆªé™¤</button>
                            <div class="cart-item-title">${item.name} Ã— ${item.qty}</div>
                            ${addonText}
                            <div class="cart-item-price">$${itemTotal}</div>
                        </div>
                    `;
                });
            }

            // æ›´æ–°æ‰‹æ©Ÿç‰ˆ Bottom Bar
            document.getElementById('bottomCount').innerText = totalQty;
            document.getElementById('bottomTotal').innerText = grandTotal;
            
            // æ›´æ–°æ‰‹æ©Ÿç‰ˆ Modal å…§çš„è³¼ç‰©è»Š
            document.getElementById('mobileCartItems').innerHTML = cartHtml;
            document.getElementById('mobileCartTotalPrice').innerText = grandTotal;

            // æ›´æ–°å¹³æ¿ç‰ˆå´é‚Šæ¬„è³¼ç‰©è»Š
            document.getElementById('desktopCartItems').innerHTML = cartHtml;
            document.getElementById('desktopCartTotalPrice').innerText = grandTotal;
        }

        function openMobileCartModal() {
            document.getElementById('mobileCartModal').style.display = 'flex';
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
            if(cart.length === 0 && window.innerWidth < 768) {
                closeModal(null, 'mobileCartModal'); // æ‰‹æ©Ÿç‰ˆæ¸…ç©ºæ™‚è‡ªå‹•é—œé–‰
            }
        }

        function clearCart() {
            if(cart.length === 0) return;
            if(confirm("ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ")) {
                cart = [];
                updateCartDisplay();
                closeModal(null, 'mobileCartModal');
            }
        }

        function closeModal(event, modalId) {
            if (event && event.target.id !== modalId) return; // é»æ“ŠåŠé€æ˜èƒŒæ™¯æ‰é—œé–‰
            document.getElementById(modalId).style.display = 'none';
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šè¤‡è£½è¨‚å–®è½‰ç‚ºæ–‡å­— ---
        function copyOrder() {
            if (cart.length === 0) return alert('è³¼ç‰©è»Šå…§æ²’æœ‰é¤é»å–”ï¼');

            let orderText = "è€é—†æ‚¨å¥½ï¼Œæˆ‘è¦è¨‚é¤ï¼š\n-----------------\n";
            let total = 0;

            cart.forEach(item => {
                let addonTotal = item.selectedAddons.reduce((sum, a) => sum + a.price, 0);
                let itemTotal = (item.price + addonTotal) * item.qty;
                total += itemTotal;

                let addonStr = item.selectedAddons.length > 0 
                    ? ` (${item.selectedAddons.map(a => a.name).join(', ')})` 
                    : '';

                orderText += `${item.name}${addonStr} x ${item.qty} = $${itemTotal}\n`;
            });

            orderText += `-----------------\nç¸½å…±ï¼š$${total} å…ƒ\nè¬è¬è€é—†ï¼`;

            // ä½¿ç”¨ Clipboard APIï¼Œè‹¥å¤±æ•—å‰‡ç”¨å‚™ç”¨æ–¹æ¡ˆ
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(orderText).then(() => {
                    alert('âœ… è¨‚å–®å·²è¤‡è£½ï¼\næ‚¨å¯ä»¥ç›´æ¥å‰å¾€ LINE è²¼ä¸Šä¸¦å‚³é€çµ¦è€é—†ã€‚');
                }).catch(err => fallbackCopyTextToClipboard(orderText));
            } else {
                fallbackCopyTextToClipboard(orderText);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0"; textArea.style.left = "0"; textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            try {
                document.execCommand('copy');
                alert('âœ… è¨‚å–®å·²è¤‡è£½ï¼\næ‚¨å¯ä»¥ç›´æ¥å‰å¾€ LINE è²¼ä¸Šä¸¦å‚³é€çµ¦è€é—†ã€‚');
            } catch (err) {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½å–”ï¼');
            }
            document.body.removeChild(textArea);
        }

        // å•Ÿå‹•ç¨‹å¼
        init();
    </script>
</body>
</html>

